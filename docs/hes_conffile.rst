
The Hesutils configuration file
===============================

All Hesutils tools that accept or require some form of configuration, read it from ``hesutils.conf``. Typically this file is installed as ``/etc/hesutils.conf``, although it may exist in a different location on your system.


Contents of hesutils.conf
-------------------------

``Hesutils.conf`` contains all the configuration parameters for all the Hesutils tools that need them.

All options are abundantly commented in the file itself, which serves as the reference for both the list of parameters, and their purposes. Please take time to read it carefully.

All options have reasonably sane default values. Those apply when the parameters are empty or unset, or when the configuration file doesn't exist. This allows ``hesgen`` to run even with a missing or empty configuration file, although it may not produce anything useful::

    $ ./hesgen -v

    Configuration file: /etc/hesutils.conf
    Passwd file:        /etc/passwd
    Group file:         /etc/group
    
    WARNING: The configuration file doesn't exist or is not readable: HESCFGFILE=/etc/hesutils.conf
             Using default values for everything.
    
    Checking the configuration file
    
    Processing the passwd file entries: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
      --> 0 Hesiod users
    
    Processing the group file entries: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
      --> 0 Hesiod groups
    
    # Generated by hesgen on Fri Feb 26 23:26:59 CET 2021
    
    local=/ns.athena.mit.edu/
    local=/hesiod/
    
    # Users
    
    # Groups
    
    # Group lists



Parameter syntax
----------------

``Hesutils.conf`` is actually a Bash code snippet. As such, the usual Bash (and sh) rules apply. Moreover, some additional rules exist in the configuration parser. 


1. No spaces around the equal sign! (Bash rule)

   This is valid::

    OUTPUTFMT=dnsmasq

   This is not, and Bash will print an error and stop::
   
    OUTPUTFMT = dnsmasq

2. Unset or empty parameters take their default values. In a few cases some parameters can be mandatory, which means that the user *must* assign it a value. See the comments in ``hesutils.conf`` for more details.

3. As in any Bash script, all previously-defined parameters are environment variables that can be reused. For example::

    GIDMIN=${UIDMIN}
    GIDMAX=${UIDMAX}

4. As in any Bash script, arbitrary commands can run at execution time to provide dynamic parameter content. For example::

    NFSSERVER=$(hostname -f)

5. Remember to enclose the parameter values in quotes if they contain spaces! (Although they shouldn't really contain spaces at all...)



Using a different configuration file
------------------------------------

For testing purposes, the Hesutils tools can read a different configuration file in an arbitrary path.

All tools can obtain the path of the configuration file from the environment variable ``HESCFGFILE``::

    $ HESCFGFILE=/tmp/testconfig.conf ./hesgen -v
    
    Configuration file: /tmp/testconfig.conf
    Passwd file:        /etc/passwd
    Group file:         /etc/group
    ...


``Hesgen`` also offers the command line option ``-c`` for the same effect::

    $ ./hesgen -v -c /tmp/testconfig.conf

    Configuration file: /tmp/testconfig.conf
    Passwd file:        /etc/passwd
    Group file:         /etc/group
    ...


``Hesadd`` doesn't support any command line option to avoid overloading ``useradd``'s and ``groupadd``'s options. In that case use the environment variable.

